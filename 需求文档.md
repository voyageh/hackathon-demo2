# 需求文档：YouTube 扩展一键调用 Gemini

## 1. 背景与目标
用户在观看 YouTube 视频时，需要快速把当前视频链接发送给 Gemini，让其完成总结、要点提炼或问答。目标是提供一个浏览器扩展，在 YouTube 页面内一键调用 Gemini，并展示返回结果。

## 2. 需求范围
- 浏览器：Chrome/Edge（基于 Chromium 的扩展）。
- 页面：YouTube 视频播放页（`https://www.youtube.com/watch?v=...`）。
- 交互方式：扩展按钮/页面内浮层入口。

## 3. 用户画像与场景
- 学习者：需要快速总结视频内容。
- 内容创作者：需要生成标题/要点/脚本摘要。
- 研究人员：需要对视频主题做快速了解。

## 4. 核心用户故事
1. 作为用户，我在 YouTube 视频页面点击扩展按钮，即可把当前视频链接发送给 Gemini。
2. 作为用户，我可以选择预设的提示词模板（如“总结”“提炼要点”“生成提纲”）。
3. 作为用户，我能在页面中看到 Gemini 返回的内容，并可复制。

## 5. 功能需求
### 5.1 入口与触发
- 扩展提供两种入口（至少一种）：
  - 浏览器工具栏图标点击。
  - YouTube 页面内悬浮按钮或视频下方按钮。
- 仅在 YouTube 视频页面展示入口，其他页面不显示或灰置。

### 5.2 获取链接
- 自动读取当前标签页的 URL。
- 校验 URL 是否为有效的 YouTube 视频链接。

### 5.3 调用 Gemini
- 调用 Gemini 接口时传入：
  - 当前视频链接。
  - 用户选择的提示词模板或自定义提示词。
- 支持以下最小模板：
  - 总结（Summarize）
  - 要点（Key Points）
  - 提纲（Outline）
- 返回结果在页面中展示，支持复制。

### 5.4 设置与配置
- 支持用户配置 Gemini API Key。
- 提供提示词模板管理（新增/编辑/删除）。
- 记录最后一次选择的模板。

### 5.5 结果展示
- 在页面右侧或弹窗中展示结果。
- 支持以下操作：复制、清空、重试。
- 返回失败时，提供明确错误提示。

## 6. 非功能需求
- 性能：点击后 1 秒内进入“处理中”状态。
- 可靠性：失败可重试，失败原因可见。
- 兼容性：至少支持 Chrome 最新两个版本。
- 安全与隐私：
  - 不上传用户任何额外隐私信息。
  - 如果使用 API Key，需本地存储并加密（或提示用户自行管理风险）。

## 7. 技术方案（建议）
- 浏览器扩展（Manifest V3）。
- 前端 UI：轻量浮层或弹窗。
- Gemini 调用方式：
  - 方案 A（推荐）：使用后端代理隐藏 API Key。
  - 方案 B（快速 MVP）：用户在扩展内填写 API Key，前端直接调用。

## 8. 权限需求
- `activeTab`：获取当前页面 URL。
- `storage`：保存 API Key 与模板。
- `scripting`：在 YouTube 页面注入入口或浮层。

## 9. 约束与边界
- 不做视频转录（仅传链接给 Gemini）。
- 不做账号登录系统（MVP 阶段）。
- 不保证 Gemini 总是可用，需提示用户检查网络/API。

## 10. 失败与异常处理
- 不是 YouTube 视频链接：提示“请在视频页面使用”。
- API Key 缺失：提示用户配置。
- Gemini 接口失败：显示错误码/错误信息，并支持重试。

## 11. 验收标准
- 在 YouTube 视频页面点击扩展按钮，成功发送链接并展示结果。
- 模板选择生效，返回内容与模板一致。
- 失败场景能正确提示用户并可重试。

## 12. 里程碑（建议）
- M1：完成基础扩展入口 + URL 读取 + 调用 Gemini。
- M2：完成模板管理 + 结果展示优化。
- M3：补齐错误处理 + 权限与隐私说明。
